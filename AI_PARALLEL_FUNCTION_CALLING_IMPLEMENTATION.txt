================================================================================
  OpenAI Function Calling with Structured Outputs Implementation Plan
  Modo Fitness App - AI Service Enhancement
  
  ğŸ“… Updated: 2025-11-04
  â­ Recommended: Function Calling + strict: true
================================================================================

ğŸ“‹ ç›®æ ‡
--------
å®ç° AI åœ¨ Insight èŠå¤©é¡µé¢åŒæ—¶æä¾›ï¼š
1. å‹å¥½çš„æ–‡æœ¬å“åº”ï¼ˆç”¨æˆ·å¯è§ï¼‰
2. ç»“æ„åŒ–çš„å‡½æ•°è°ƒç”¨ï¼ˆåå°åˆ›å»ºä»»åŠ¡ï¼‰
3. AI è‡ªåŠ¨åˆ¤æ–­ï¼šçº¯èŠå¤© vs ä»»åŠ¡åˆ›å»º

ğŸ”„ æ–¹æ¡ˆå˜æ›´è¯´æ˜
---------------
**2025-11-04 æ›´æ–°ï¼š**
ç»è¿‡è°ƒç ”ï¼Œæ¨èæ–¹æ¡ˆä» "response_format (çº¯ JSON)" æ”¹ä¸º "Function Calling + strict: true"

ç†ç”±ï¼š
âœ… æ›´çµæ´»ï¼šAI å¯ä»¥è‡ªå·±åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºä»»åŠ¡
âœ… æ›´è‡ªç„¶ï¼šçº¯èŠå¤©æ—¶ä¸ä¼šæœ‰å¤šä½™çš„ç©ºæ•°æ®
âœ… æ›´ç®€å•ï¼šä½ çš„ä»£ç å·²æœ‰ Function Calling åŸºç¡€ï¼Œåªéœ€æ·»åŠ  strict: true
âœ… åŒæ ·ä¿è¯ï¼šstrict: true æä¾› 100% JSON æ ¼å¼ä¿è¯

æ”¯æŒæ¨¡å‹ï¼šgpt-4o, gpt-4o-mini (2024å¹´8æœˆåç‰ˆæœ¬)

âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆTL;DRï¼‰
-------------------
åªéœ€ä¿®æ”¹ 3 ä¸ªåœ°æ–¹ï¼š

1. OpenAIConfig.swift - æ·»åŠ  strict å­—æ®µæ”¯æŒ
2. OpenAIService.swift - buildFunctions() ä¸­æ·»åŠ  strict: true  
3. ModoCoachService.swift - å¯ç”¨ Function Callingï¼Œå¤„ç†å“åº”

é¢„è®¡æ—¶é—´ï¼š3-5 å°æ—¶
éš¾åº¦ï¼šâ­â­â­ (ä¸­ç­‰)

è¯¦ç»†æ­¥éª¤è§ä¸‹æ–¹ "æ–¹æ¡ˆ A" éƒ¨åˆ† â†“

ğŸ¯ æ–¹æ¡ˆé€‰æ‹©
------------
**æ¨èï¼šFunction Calling + strict: true (å¢å¼ºç‰ˆï¼Œ2024)**
- 100% JSON æ ¼å¼ä¿è¯
- AI è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºä»»åŠ¡
- çº¯èŠå¤©å’Œä»»åŠ¡åˆ›å»ºæ— ç¼åˆ‡æ¢
- å½“å‰ä»£ç å·²æœ‰åŸºç¡€ï¼Œæ”¹åŠ¨æœ€å°
- æ”¯æŒæ¨¡å‹ï¼šgpt-4o, gpt-4o-mini (2024å¹´8æœˆå)

**å¤‡é€‰ï¼šresponse_format (çº¯ JSON è¾“å‡º)**
- é€‚åˆæ€»æ˜¯éœ€è¦è¿”å›ç»“æ„åŒ–æ•°æ®çš„åœºæ™¯
- å®ç°ç¨ç®€å•ï¼Œä½†çµæ´»æ€§è¾ƒå·®


================================================================================
æ–¹æ¡ˆ Aï¼šFunction Calling + strict: true (æ¨è â­â­â­â­â­)
================================================================================

ğŸ¯ ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªæ–¹æ¡ˆ
--------------------
1. âœ… çµæ´»æ€§æœ€å¼ºï¼šAI è‡ªå·±å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å‡½æ•°
   - çº¯èŠå¤©ï¼š"å¤©æ°”æ€ä¹ˆæ ·" â†’ åªè¿”å›æ–‡æœ¬
   - éœ€è¦ä»»åŠ¡ï¼š"æ˜å¤©çš„å¥èº«è®¡åˆ’" â†’ è¿”å›æ–‡æœ¬ + è°ƒç”¨å‡½æ•°

2. âœ… ç”¨æˆ·ä½“éªŒæœ€å¥½ï¼š
   - ç”¨æˆ·æ€»èƒ½çœ‹åˆ°å‹å¥½çš„æ–‡å­—è§£é‡Š
   - ä¸éœ€è¦ä»»åŠ¡æ—¶ï¼Œä¸ä¼šæœ‰å¤šä½™çš„ç©ºæ•°æ®

3. âœ… æ”¹åŠ¨æœ€å°ï¼š
   - ä½ çš„ä»£ç å·²ç»æœ‰ buildFunctions()
   - åªéœ€æ·»åŠ  strict: true å’Œå¤„ç†é€»è¾‘

4. âœ… 100% æ ¼å¼ä¿è¯ï¼š
   - strict: true ç¡®ä¿å‡½æ•°å‚æ•°å®Œå…¨ç¬¦åˆ schema
   - ä¸ä¼šå†æœ‰è§£æé”™è¯¯

âš ï¸ é‡è¦é™åˆ¶
-----------
ä½¿ç”¨ strict: true æ—¶ï¼š
- âŒ ä¸æ”¯æŒ parallel_tool_callsï¼ˆå¹¶è¡Œå‡½æ•°è°ƒç”¨ï¼‰
- âœ… ä½†ä½ çš„åœºæ™¯ä¸éœ€è¦å¹¶è¡Œï¼ˆä¸€æ¬¡åªåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼‰
- âœ… éœ€è¦åœ¨ API è°ƒç”¨æ—¶è®¾ç½® parallel_tool_calls: false

ğŸ”§ å®ç°æ­¥éª¤
-----------

### Step 1: ä¿®æ”¹ OpenAIConfig.swift - æ·»åŠ  strict å‚æ•°æ”¯æŒ

åœ¨ç°æœ‰çš„ Function å®šä¹‰ä¸­æ·»åŠ  strict å­—æ®µå’Œ parallel_tool_calls å‚æ•°ï¼š

```swift
struct ChatCompletionRequest: Codable {
    let model: String
    let messages: [Message]
    let temperature: Double
    let maxTokens: Int?
    let functions: [Function]?
    let functionCall: String?
    let parallelToolCalls: Bool?  // â† æ–°å¢ï¼šæ§åˆ¶å¹¶è¡Œè°ƒç”¨
    
    enum CodingKeys: String, CodingKey {
        case model, messages, temperature
        case maxTokens = "max_tokens"
        case functions
        case functionCall = "function_call"
        case parallelToolCalls = "parallel_tool_calls"  // â† æ–°å¢
    }
    
    struct Function: Codable {
        let name: String
        let description: String
        let parameters: Parameters
        let strict: Bool?  // â† æ–°å¢ï¼šæ”¯æŒ strict mode
        
        // â† æ–°å¢ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•
        init(name: String, description: String, parameters: Parameters, strict: Bool = false) {
            self.name = name
            self.description = description
            self.parameters = parameters
            self.strict = strict
        }
        
        // ... ç°æœ‰çš„ Parameters å®šä¹‰ ...
    }
}
```

### Step 2: ä¿®æ”¹ OpenAIService.swift - åœ¨ buildFunctions() ä¸­å¯ç”¨ strict

åªéœ€ä¿®æ”¹ç°æœ‰çš„ buildFunctions() æ–¹æ³•ï¼š

```swift
func buildFunctions() -> [ChatCompletionRequest.Function] {
    return [
        // Generate Workout Plan Function
        ChatCompletionRequest.Function(
            name: "generate_workout_plan",
            description: """
            Generate a personalized daily workout plan with specific exercises.
            MUST include at least 3-5 exercises with sets, reps, and rest periods.
            """,
            parameters: ChatCompletionRequest.Function.Parameters(
                type: "object",
                properties: [
                    // ... ç°æœ‰çš„ property å®šä¹‰ ...
                ],
                required: ["date", "goal", "exercises"]
            ),
            strict: true  // â† åªéœ€æ·»åŠ è¿™ä¸€è¡Œï¼
        ),
        
        // Generate Nutrition Plan Function (åŒæ ·æ·»åŠ  strict: true)
        ChatCompletionRequest.Function(
            name: "generate_nutrition_plan",
            description: "Generate daily meal plan with specific foods and calories",
            parameters: ChatCompletionRequest.Function.Parameters(
                // ... ç°æœ‰å®šä¹‰ ...
            ),
            strict: true  // â† æ·»åŠ è¿™ä¸€è¡Œ
        )
    ]
}
```

### Step 3: ä¿®æ”¹ ModoCoachService.swift - å¯ç”¨ Function Calling

æœ€å…³é”®çš„ä¿®æ”¹ï¼š

```swift
func sendMessage(_ text: String, userProfile: UserProfile?) {
    Task {
        do {
            isLoading = true
            
            // æ„å»ºæ¶ˆæ¯ï¼ˆç°æœ‰ä»£ç ï¼‰
            var apiMessages: [ChatCompletionRequest.Message] = []
            
            // æ·»åŠ  system prompt
            let systemPrompt = promptBuilder.buildChatSystemPrompt(userProfile: userProfile)
            apiMessages.append(ChatCompletionRequest.Message(
                role: "system",
                content: systemPrompt
            ))
            
            // æ·»åŠ å†å²æ¶ˆæ¯ + å½“å‰æ¶ˆæ¯ï¼ˆç°æœ‰é€»è¾‘ï¼‰
            // ...
            
            // â­ å…³é”®ä¿®æ”¹ï¼šå¯ç”¨ Function Calling with strict: true
            let response = try await OpenAIService.shared.sendChatRequest(
                messages: apiMessages,
                functions: OpenAIService.shared.buildFunctions(),  // â† æ·»åŠ ï¼ˆåŒ…å« strict: trueï¼‰
                functionCall: "auto",  // â† AI è‡ªå·±å†³å®šæ˜¯å¦è°ƒç”¨
                parallelToolCalls: false  // â† å¿…é¡»è®¾ç½®ä¸º falseï¼ˆstrict æ¨¡å¼è¦æ±‚ï¼‰
            )
            
            await MainActor.run {
                // 1ï¸âƒ£ æ€»æ˜¯æ˜¾ç¤ºæ–‡æœ¬å“åº”ï¼ˆç”¨æˆ·å¯è§ï¼‰
                if let textContent = response.choices.first?.message.content, !textContent.isEmpty {
                    let aiMessage = ChatMessage(
                        content: textContent,
                        isFromUser: false
                    )
                    self.messages.append(aiMessage)
                    self.saveMessage(aiMessage)
                }
                
                // 2ï¸âƒ£ å¦‚æœæœ‰ Function Callï¼Œåˆ›å»ºä»»åŠ¡ï¼ˆåå°ï¼‰
                if let functionCall = response.choices.first?.message.functionCall {
                    print("ğŸ”§ Function called: \(functionCall.name)")
                    handleFunctionCall(functionCall)
                }
                
                isLoading = false
            }
        } catch {
            await MainActor.run {
                isLoading = false
                print("âŒ Error: \(error)")
            }
        }
    }
}

// â­ æ–°å¢æ–¹æ³•ï¼šå¤„ç† Function Call
private func handleFunctionCall(_ functionCall: ChatCompletionResponse.Choice.Message.FunctionCall) {
    guard let data = functionCall.arguments.data(using: .utf8) else { return }
    
    switch functionCall.name {
    case "generate_workout_plan":
        // è§£æ JSON (ç°åœ¨ 100% ç¬¦åˆ schemaï¼Œä¸ä¼šå¤±è´¥ï¼)
        if let workoutPlan = try? JSONDecoder().decode(WorkoutPlanFunctionResponse.self, from: data) {
            createWorkoutTaskFromFunction(workoutPlan)
        }
        
    case "generate_nutrition_plan":
        // åŒæ ·çš„å¤„ç†
        if let nutritionPlan = try? JSONDecoder().decode(NutritionPlanFunctionResponse.self, from: data) {
            createNutritionTasksFromFunction(nutritionPlan)
        }
        
    default:
        print("âš ï¸ Unknown function: \(functionCall.name)")
    }
}

// è¾…åŠ©æ–¹æ³•ï¼šä» Function Response åˆ›å»ºä»»åŠ¡
private func createWorkoutTaskFromFunction(_ workout: WorkoutPlanFunctionResponse) {
    let exercisesData = workout.exercises.map { exercise -> [String: Any] in
        return [
            "name": exercise.name,
            "sets": exercise.sets,
            "reps": exercise.reps,
            "restSec": exercise.restSec ?? 60,
            "durationMin": 5,  // æ ¹æ® sets * reps ä¼°ç®—
            "calories": 30     // æ ¹æ®è¿åŠ¨å¼ºåº¦ä¼°ç®—
        ]
    }
    
    let userInfo: [String: Any] = [
        "date": workout.date,
        "time": "09:00 AM",
        "theme": "Workout",
        "goal": workout.goal,
        "exercises": exercisesData,
        "totalDuration": exercisesData.count * 5,
        "totalCalories": exercisesData.count * 30,
        "isNutrition": false,
        "isAIGenerated": true
    ]
    
    NotificationCenter.default.post(
        name: NSNotification.Name("CreateWorkoutTask"),
        object: nil,
        userInfo: userInfo
    )
}
```

### Step 4: æ›´æ–° AIPromptBuilder.swift - ä¼˜åŒ– System Prompt

å¼ºè°ƒ AI åº”è¯¥åŒæ—¶æä¾›æ–‡æœ¬è§£é‡Šå’Œè°ƒç”¨å‡½æ•°ï¼š

```swift
func buildChatSystemPrompt(userProfile: UserProfile?) -> String {
    var prompt = """
    You are Modo, a professional fitness coach assistant.
    
    RESPONSE STRATEGY:
    
    For workout/meal plan requests:
    1. ALWAYS provide a detailed, friendly text explanation
       - Use markdown formatting (**bold** for headings)
       - Include specific details (sets, reps, calories, timing)
       - Be encouraging and motivating
       
    2. THEN call the appropriate function:
       - generate_workout_plan() for exercise plans
       - generate_nutrition_plan() for meal plans
       
    3. Both text AND function call are REQUIRED for plan requests
    
    For casual chat (e.g. "How are you?", "What's the weather?"):
    - Just respond naturally with text
    - Do NOT call any functions
    
    Example for workout request:
    
    Text response:
    "Great! Here's your personalized morning workout:
    
    **Upper Body Strength**
    1. Push-ups - 3 sets Ã— 12 reps (90 sec rest)
       Builds chest and tricep strength
    
    2. Dumbbell Rows - 3 sets Ã— 10 reps (60 sec rest)
       Targets your back muscles
    
    This 45-minute workout will help you build muscle! ğŸ’ª"
    
    [THEN call generate_workout_plan() with structured data]
    """
    
    // æ·»åŠ ç”¨æˆ·ä¿¡æ¯...
    if let profile = userProfile {
        prompt += "\n\nUser Profile:\n"
        prompt += "Age: \(profile.age), "
        prompt += "Weight: \(profile.weight) \(profile.weightUnit == "kg" ? "kg" : "lbs"), "
        prompt += "Goal: \(profile.goal)"
        // ...
    }
    
    return prompt
}
```


================================================================================
æ–¹æ¡ˆ Bï¼šresponse_format (å¤‡é€‰æ–¹æ¡ˆ)
================================================================================

å¦‚æœä½ æ›´å–œæ¬¢çº¯ JSON è¾“å‡ºï¼ˆä¸éœ€è¦ AI åˆ¤æ–­ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ response_formatï¼š

âš ï¸ æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ¡ˆä¼šè®© AI **æ€»æ˜¯**è¿”å›ç»“æ„åŒ–æ•°æ®ï¼Œå³ä½¿æ˜¯çº¯èŠå¤©ä¹Ÿä¼šæœ‰ç©ºçš„ task_dataã€‚

ğŸ”§ å®ç°æ¦‚è¦
-----------

```swift
// 1. å®šä¹‰ response schema
let responseFormat = ResponseFormat(
    type: "json_schema",
    jsonSchema: JSONSchema(
        name: "fitness_response",
        strict: true,
        schema: {
            "type": "object",
            "properties": {
                "user_message": {"type": "string"},
                "task_type": {"type": "string", "enum": ["workout", "nutrition", "both", "none"]},
                "workout": {...},
                "nutrition": {...}
            },
            "required": ["user_message", "task_type"]
        }
    )
)

// 2. è°ƒç”¨ API
let response = try await OpenAIService.shared.sendChatRequest(
    messages: messages,
    responseFormat: responseFormat  // ä½¿ç”¨ response_format è€Œä¸æ˜¯ functions
)

// 3. è§£æ JSON
let jsonData = response.choices.first?.message.content?.data(using: .utf8)
let structured = try JSONDecoder().decode(FitnessResponse.self, from: jsonData)
```

ğŸ“Š å¯¹æ¯”

| ç‰¹æ€§ | Function Calling (æ–¹æ¡ˆA) | response_format (æ–¹æ¡ˆB) |
|------|-------------------------|------------------------|
| çµæ´»æ€§ | â­â­â­â­â­ AI å†³å®š | â­â­â­ æ€»æ˜¯è¿”å› JSON |
| çº¯èŠå¤©ä½“éªŒ | â­â­â­â­â­ è‡ªç„¶ | â­â­â­ æœ‰å¤šä½™æ•°æ® |
| å®ç°å¤æ‚åº¦ | â­â­â­ ç¨å¤æ‚ | â­â­â­â­ è¾ƒç®€å• |
| æ¨èåº¦ | âœ… æ¨è | âš ï¸ ä¸æ¨è |


================================================================================
ğŸ“Š æµ‹è¯•æ–¹æ¡ˆ
================================================================================

1. æµ‹è¯•åœºæ™¯
-----------
   âœ… çº¯èŠå¤©ï¼ˆä¸åˆ›å»ºä»»åŠ¡ï¼‰
   âœ… è¯·æ±‚å¥èº«è®¡åˆ’
   âœ… è¯·æ±‚é¥®é£Ÿè®¡åˆ’
   âœ… åŒæ—¶è¯·æ±‚å¥èº« + é¥®é£Ÿ
   âœ… å¤šå¤©è®¡åˆ’

2. éªŒè¯ç‚¹
---------
   âœ… ç”¨æˆ·çœ‹åˆ°å‹å¥½çš„æ–‡æœ¬å“åº”
   âœ… ä»»åŠ¡åœ¨ MainPage æ­£ç¡®åˆ›å»º
   âœ… æ‰€æœ‰å­—æ®µï¼ˆå¡è·¯é‡Œã€æ—¶é•¿ç­‰ï¼‰æ­£ç¡®
   âœ… AI badge æ˜¾ç¤ºæ­£ç¡®
   âœ… æ— é‡å¤ä»»åŠ¡ç”Ÿæˆ

3. é”™è¯¯å¤„ç†
-----------
   âœ… API å¤±è´¥æ—¶çš„ fallback
   âœ… JSON è§£æå¤±è´¥æ—¶çš„å¤„ç†
   âœ… éƒ¨åˆ†æ•°æ®ç¼ºå¤±æ—¶çš„è¡¥å…¨


================================================================================
ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–
================================================================================

1. ç¼“å­˜ç­–ç•¥
-----------
   - ç›¸åŒè¯·æ±‚ 5 åˆ†é’Ÿå†…ä½¿ç”¨ç¼“å­˜
   - å‡å°‘ API è°ƒç”¨æ¬¡æ•°

2. è¶…æ—¶å¤„ç†
-----------
   - è®¾ç½® 30 ç§’è¶…æ—¶
   - è¶…æ—¶åæ˜¾ç¤ºå‹å¥½æç¤º

3. Token ä¼˜åŒ–
-------------
   - System Prompt ç²¾ç®€ï¼ˆå½“å‰å¯èƒ½è¿‡é•¿ï¼‰
   - ä½¿ç”¨ max_tokens é™åˆ¶è¾“å‡º


================================================================================
ğŸ’° æˆæœ¬ä¼°ç®—
================================================================================

å½“å‰ä½¿ç”¨ GPT-4o:
- è¾“å…¥ï¼š$5 / 1M tokens
- è¾“å‡ºï¼š$15 / 1M tokens

å•æ¬¡è¯·æ±‚ï¼ˆç”Ÿæˆå¥èº«è®¡åˆ’ï¼‰ï¼š
- System Prompt: ~500 tokens
- User Message: ~50 tokens
- AI Response: ~300 tokens
- æˆæœ¬ï¼šçº¦ $0.007

æ¯å¤© 100 ä¸ªç”¨æˆ·ï¼Œæ¯äºº 3 æ¬¡è¯·æ±‚ï¼š
- æœˆæˆæœ¬ï¼š300 Ã— 30 Ã— $0.007 = $63

ä¼˜åŒ–å»ºè®®ï¼š
- æ··åˆä½¿ç”¨ GPT-4o-miniï¼ˆä¾¿å®œ 10 å€ï¼‰ç”¨äºç®€å•å¯¹è¯
- åªåœ¨ç”Ÿæˆè®¡åˆ’æ—¶ä½¿ç”¨ GPT-4o


================================================================================
ğŸš€ å®æ–½æ­¥éª¤ï¼ˆæ–¹æ¡ˆ A - Function Calling + strictï¼‰
================================================================================

Phase 1: æ·»åŠ  strict æ”¯æŒï¼ˆ30 åˆ†é’Ÿï¼‰â­ æœ€ç®€å•
-------------------------------
1. ä¿®æ”¹ OpenAIConfig.swift - æ·»åŠ  strict å­—æ®µæ”¯æŒ
2. ä¿®æ”¹ OpenAIService.swift - åœ¨ buildFunctions() ä¸­æ·»åŠ  strict: true

Phase 2: é›†æˆåˆ°èŠå¤©ï¼ˆ1-2 å°æ—¶ï¼‰
-------------------------------
3. ä¿®æ”¹ ModoCoachService.swift - å¯ç”¨ Function Calling
4. æ·»åŠ  handleFunctionCall() æ–¹æ³•å¤„ç†å‡½æ•°å“åº”
5. æ›´æ–° AIPromptBuilder.swift çš„ System Prompt

Phase 3: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2 å°æ—¶ï¼‰
-------------------------------
6. æµ‹è¯•çº¯èŠå¤©åœºæ™¯ï¼ˆä¸åº”è°ƒç”¨å‡½æ•°ï¼‰
7. æµ‹è¯•ä»»åŠ¡ç”Ÿæˆåœºæ™¯ï¼ˆåº”è°ƒç”¨å‡½æ•° + æ˜¾ç¤ºæ–‡æœ¬ï¼‰
8. æ·»åŠ é”™è¯¯å¤„ç†å’Œ fallback
9. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

æ€»è®¡ï¼š3-5 å°æ—¶ âœ… (æ¯”åŸæ–¹æ¡ˆå¿« 50%ï¼)


================================================================================
ğŸ“š å‚è€ƒèµ„æº
================================================================================

1. OpenAI Structured Outputs æ–‡æ¡£:
   https://platform.openai.com/docs/guides/structured-outputs

2. Function Calling æ–‡æ¡£:
   https://platform.openai.com/docs/guides/function-calling

3. JSON Schema è§„èŒƒ:
   https://json-schema.org/


================================================================================
âœ… Checklist
================================================================================

å®ç°å‰:
â–¡ å¤‡ä»½å½“å‰ä»£ç 
â–¡ åˆ›å»ºæ–°çš„ feature åˆ†æ”¯
â–¡ ç¡®è®¤ OpenAI API key æœ‰æ•ˆ

å®ç°ä¸­ï¼ˆæ–¹æ¡ˆ A - Function Calling + strictï¼‰:
â–¡ ä¿®æ”¹ OpenAIConfig.swift æ·»åŠ  strict å­—æ®µ
â–¡ ä¿®æ”¹ OpenAIService.swift åœ¨ buildFunctions() ä¸­æ·»åŠ  strict: true
â–¡ ä¿®æ”¹ ModoCoachService.swift å¯ç”¨ Function Calling
â–¡ æ·»åŠ  handleFunctionCall() æ–¹æ³•
â–¡ æ›´æ–° AIPromptBuilder.swift çš„ System Prompt
â–¡ (å¯é€‰) ç¼–å†™å•å…ƒæµ‹è¯•

æµ‹è¯•:
â–¡ æµ‹è¯•çº¯èŠå¤©åœºæ™¯
â–¡ æµ‹è¯•å¥èº«è®¡åˆ’ç”Ÿæˆ
â–¡ æµ‹è¯•é¥®é£Ÿè®¡åˆ’ç”Ÿæˆ
â–¡ æµ‹è¯•ç»„åˆè®¡åˆ’
â–¡ æµ‹è¯•é”™è¯¯æƒ…å†µ

éƒ¨ç½²:
â–¡ Code review
â–¡ åˆå¹¶åˆ° develop
â–¡ ç›‘æ§ API æˆæœ¬
â–¡ æ”¶é›†ç”¨æˆ·åé¦ˆ


================================================================================
â“ å¸¸è§é—®é¢˜
================================================================================

Q: Function Calling + strict å’Œ response_format å“ªä¸ªæ›´å¥½ï¼Ÿ
A: Function Calling + strict æ›´é€‚åˆä½ çš„åœºæ™¯ï¼š
   - âœ… AI è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºä»»åŠ¡
   - âœ… çº¯èŠå¤©ä½“éªŒæ›´è‡ªç„¶
   - âœ… 100% JSON æ ¼å¼ä¿è¯ï¼ˆstrict: trueï¼‰
   - âœ… ä»£ç æ”¹åŠ¨æœ€å°ï¼ˆä½ å·²æœ‰ buildFunctions()ï¼‰
   
   response_format çš„é—®é¢˜ï¼š
   - âŒ çº¯èŠå¤©æ—¶ä¹Ÿä¼šè¿”å›å¤šä½™çš„ç©ºæ•°æ®
   - âŒ ä¸å¤Ÿçµæ´»

Q: å¦‚æœ API è¿”å›æ ¼å¼é”™è¯¯æ€ä¹ˆåŠï¼Ÿ
A: æ·»åŠ  fallback åˆ°çº¯æ–‡æœ¬è§£æï¼ˆå½“å‰çš„ Regex æ–¹æ¡ˆï¼‰

Q: ä¼šå¢åŠ å¤šå°‘æˆæœ¬ï¼Ÿ
A: å‡ ä¹ç›¸åŒï¼Œå¯èƒ½ç•¥å¾®å¢åŠ ï¼ˆå› ä¸ºè¿”å›çš„ JSON æ›´å¤§ï¼‰

Q: éœ€è¦é‡å†™æ‰€æœ‰ AI ç›¸å…³ä»£ç å—ï¼Ÿ
A: ä¸éœ€è¦ï¼Œåªéœ€ä¿®æ”¹ ModoCoachService.swift å’Œç›¸å…³é…ç½®

Q: å¯ä»¥åªåœ¨ Insight é¡µé¢ä½¿ç”¨ï¼Œå…¶ä»–åœ°æ–¹ä¿æŒä¸å˜å—ï¼Ÿ
A: å¯ä»¥ï¼AITaskGenerator ç­‰å¯ä»¥ç»§ç»­ä½¿ç”¨å½“å‰çš„çº¯æ–‡æœ¬æ–¹æ¡ˆ


================================================================================
ğŸ“ æ›´æ–°æ—¥å¿—
================================================================================

2025-11-04: åˆå§‹ç‰ˆæœ¬
- å®Œæ•´çš„ Structured Outputs å®ç°æ–¹æ¡ˆ
- å¤‡é€‰çš„ Function Calling æ–¹æ¡ˆ
- è¯¦ç»†çš„æµ‹è¯•å’Œéƒ¨ç½²è®¡åˆ’

================================================================================

